{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AudioX - Made in Pakistan{% endblock %}</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/ourteamstyle.css' %}">
    <link rel="stylesheet" href="{% static 'css/paymentpolicystyle.css' %}">
    <link rel="stylesheet" href="{% static 'css/privacypolicy.css' %}">
    <link rel="stylesheet" href="{% static 'css/piracypolicy.css' %}">
    <link rel="stylesheet" href="{% static 'css/termsandconditions.css' %}">
    <link rel="stylesheet" href="{% static 'css/aboutus.css' %}">
    <link rel="stylesheet" href="{% static 'css/ourteamstyle.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ... (Your existing CSS styles - keep them all) ... */
        /*  I am putting your styles. I am not removing them you can remove duplicate if needed */
        .audiotype-logo .logo-dot {
            width: 0.5rem;
            height: 0.5rem;
            margin-left: 0.05rem;
        }

        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 2px #091e65, 0 0 0 4px rgba(9, 30, 101, 0.3);
            border-radius: 9999px;
        }

        .btn-primary {
            background-color: #091e65;
            color: white;
            padding: 0.5rem 1rem;
            font-weight: 600;
            border-radius: 9999px;
            transition: background-color 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #071852;
        }

        .btn-secondary {
            border: 2px solid #091e65;
            color: #091e65;
            padding: 0.5rem 1rem;
            font-weight: 600;
            border-radius: 9999px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .btn-secondary:hover {
            background-color: #091e65;
            color: white;
        }

        .btn-icon {
            padding: 0.5rem;
            border-radius: 9999px;
            transition: background-color 0.2s ease;
            color: #6b7280;
        }

        .btn-icon:hover {
            background-color: #f3f4f6;
        }

        .header-profile-picture {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #fff;
        }

        .default-profile-icon-header {
            font-size: 20px;
        }


        /* ---  New Sidemenu Styles  --- */
        .slide-menu {
            position: fixed;
            top: 0;
            left: -300px;
            /* Start off-screen */
            width: 300px;
            height: 100%;
            background-color: #1a237e;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            /* Scrollable content */
            display: flex;
            flex-direction: column;
            /* Stack content vertically */
        }

        .slide-menu.open {
            left: 0;
        }

        .slide-menu .slider-header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .slide-menu .close-btn {
            cursor: pointer;
            color: #fff;
            font-size: 1.8rem;
            transition: color 0.2s;
            order: 2;
            /* Close button on the right */
        }

        .slide-menu .close-btn:hover {
            color: #bbb;
        }

        .slide-menu .audiotype-logo {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            order: 1;
            /* Logo on the left */
        }

        .slide-menu .logo-dot {
            width: 0.4rem;
            height: 0.4rem;
            margin-left: 0.1rem;
            background-color: #facc15;
            border-radius: 50%;
        }

        .slide-menu .menu-content {
            flex-grow: 1;
            /* Allow content to take remaining space */
            padding: 1rem 0;
            /* Padding for the main menu area */
            overflow-y: auto;
            /* Scrollable if content overflows */
        }

        .slide-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .slide-menu a {
            display: flex;
            /* Use flex for icon alignment */
            align-items: center;
            padding: 0.8rem 1.5rem;
            color: #eee;
            text-decoration: none;
            transition: background-color 0.2s, color 0.2s;
        }

        .slide-menu a:hover {
            background-color: #303f9f;
            /* Darker on hover */
            color: #fff;
        }

        .slide-menu .menu-item i {
            margin-right: 1rem;
            width: 20px;
            /* Consistent icon width */
            text-align: center;
        }

        .slide-menu .sub-menu {
            display: none;
            /* Hidden by default */
            background-color: rgba(0, 0, 0, 0.1);
            margin-left: 0;
            padding-left: 0;
        }

        .slide-menu .sub-menu a {
            padding-left: 3rem;
            /* Indent submenu items */
            font-size: 0.9rem;
        }

        .has-submenu:hover + .sub-menu,
        .sub-menu:hover {
            display: block;
        }

        .slide-menu .separator {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin: 1rem 1.5rem;
        }

        /* --- User Info Styles --- */
        .slide-menu .user-info {
            padding: 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
            display: flex;
            /* Use flexbox for layout */
            flex-direction: column;
            /* Stack items vertically */
            align-items: center;
            /* Center items horizontally */
        }

        .slide-menu .user-info .profile-picture-wrapper {
            width: 80px;
            /* Or whatever size you want */
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            /* Clip image to circle */
            border: 3px solid #facc15;
            margin-bottom: 0.75rem;
            /* Space below picture */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .slide-menu .user-info img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Ensure the image fills the circle */
        }

        .slide-menu .user-info .default-profile-icon {
            font-size: 48px;
            /* Larger default icon */
            color: #fff;
            line-height: 80px;
            /* Vertically center the icon */
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #facc15;
            margin-bottom: 0.75rem;
        }

        .slide-menu .user-info .user-names {
            color: #fff;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            /* Space below name */
        }

        .slide-menu .user-info .user-bio {
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.4;
            /* Improve readability for longer bios */
            margin-bottom: 1rem;
            font-style: italic;
        }

        /* ---  Login/Signup Section --- */
        .slide-menu .login-signup-section {
            padding: 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
        }

        .slide-menu .login-signup-btn {
            background-color: #facc15;
            color: #1a237e;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            text-decoration: none;
            transition: background-color 0.2s;
            display: inline-block;
            /* Important for centering */
            width: 80%;
            margin: 0 auto;
        }

        .slide-menu .login-signup-btn:hover {
            background-color: #eab308;
        }

        .slide-menu .login-signup-section small {
            display: block;
            /* Make the small text a block element */
            margin-top: 0.5rem;
            /* Add some space above */
            color: #ccc;
        }

        /* --- Feature Item Styles --- */
        .slide-menu .feature-item a {
            background-color: #facc15;
            color: #1a237e;
            font-weight: bold;
            border-radius: 0.375rem;
            margin: 0.5rem 1.5rem;
            /* Remove padding overrides from .menu-item */
            padding: 0.8rem 1.5rem;
        }

        .slide-menu .feature-item a:hover {
            background-color: #eab308;
        }


        /* --- Footer Styles --- */
        .slide-menu footer {
            padding: 1.5rem;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: auto;
            /* Push to bottom */
            font-size: 0.85rem;
            color: #ccc;
        }

        /* Logout Button */
        .logout-btn {
            display: block;
            width: 80%;
            margin: 1rem auto;
            padding: 0.75rem 1.5rem;
            background-color: #e53e3e;
            /* Red */
            color: white;
            font-weight: bold;
            text-align: center;
            border-radius: 0.375rem;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .logout-btn:hover {
            background-color: #c53030;
        }

        /* Coin Wallet Button */
        .coin-wallet-btn {
            background-color: #facc15;
            /* Yellow background */
            color: #1a237e;
            /* Dark blue text */
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            /* Fully rounded corners */
            font-weight: 600;
            display: flex;
            /* Use flexbox for alignment */
            align-items: center;
            /* Vertically center icon and text */
            transition: background-color 0.2s ease;
            /* Smooth transition */
            border: none;
            /* Remove default button border */
            cursor: pointer;
            /* Show pointer cursor on hover */
        }

        .coin-wallet-btn i {
            margin-right: 0.5rem;
            /* Space between icon and text */
        }

        .coin-wallet-btn:hover {
            background-color: #eab308;
            /* Slightly darker yellow on hover */
            text-decoration: none;
            /* Remove underline on hover, if any */
            color: #1a237e;
            /* Ensure text color stays consistent */
        }

        .subscription-status-box {
            background-color: rgba(255, 255, 255, 0.1);
            /* Semi-transparent white */
            border: 1px solid rgba(255, 255, 255, 0.2);
            /* Subtle border */
            border-radius: 0.375rem;
            padding: 0.5rem 1rem;
            text-align: center;
            margin-bottom: 1rem;
            color: #fff;
            font-size: 0.9rem;
        }

        .subscription-status-box.free {
            background-color: rgba(250, 204, 21, 0.2);
            /* Lighter Yellow */
            border-color: #facc15;
            color: #facc15;
            font-weight: bold;
        }

        .subscription-status-box.premium {
            background-color: rgba(21, 128, 61, 0.2);
            /* Lighter Green */
            border-color: #15803d;
            color: #15803d;
            font-weight: bold;

        }
    </style>
</head>

<body style="display: flex; flex-direction: column; min-height: 100vh;" class="bg-gray-50">
    {% block header %}
    <header class="bg-white shadow-md py-2">
        <div class="container mx-auto flex items-center justify-between px-4">

            <div class="flex items-center">
                <button id="menu-toggle" class="btn-icon mr-4">
                    <i class="fas fa-bars text-xl"></i>
                </button>

                <a href="/Home" class="flex items-center mr-6">
                    <div class="flex items-center audiotype-logo">
                        <span class="text-2xl font-extrabold text-[#091e65] tracking-tighter">AUDIO</span>
                        <span class="text-2xl font-extrabold text-red-600 tracking-tighter">X</span>
                        <div class="w-4 h-4 bg-yellow-400 rounded-full ml-1 logo-dot"></div>
                    </div>
                </a>
            </div>
            <div class="flex items-center w-full max-w-xl mx-4">
                <div class="relative w-full">
                    <input type="text" id="search-input" placeholder="Search audiobooks & stories"
                        class="w-full pl-10 pr-16 py-2 border border-[#091e65] rounded-full focus-ring placeholder-gray-500 text-gray-800" />
                    <button class="absolute left-3 top-1/2 -translate-y-1/2 btn-icon" id="search-btn" title="Search">
                        <i class="fas fa-search"></i>
                    </button>
                    <button id="voice-search-btn" class="absolute right-3 top-1/2 -translate-y-1/2 btn-icon"
                        title="Search by Voice">
                        <img src="{% static 'img/microphone-icon.png' %}" alt="Microphone" class="h-5 w-5">
                    </button>
                </div>
            </div>

            <div class="flex items-center space-x-3">
                <select class="px-2 py-1 border border-[#091e65] rounded-full text-gray-700 focus-ring text-sm"
                    id="language-selector">
                    <option value="en">English</option>
                    <option value="ur">اردو</option>
                    <option value="pun"> پنجابی </option>
                    <option value="sd"> سنڌي </option>


                </select>

                {% if user.is_authenticated %}
                <button class="coin-wallet-btn">
                    <i class="fas fa-coins"></i>
                    <span>{{ user.coins }} Coins</span>
                </button>
                {% else %}
                <button class="btn-primary flex items-center">
                    <i class="fas fa-coins mr-1"></i>
                    GET PREMIUM
                </button>
                {% endif %}

                {% if user.is_authenticated %}
                <div class="relative">
                    <button class="btn-icon focus:outline-none" id="profile-dropdown-toggle">
                        <div class="profile-picture-icon flex items-center">
                            {% if user.profile_pic %}
                            <img src="{{ user.profile_pic.url }}" alt="Profile Picture" class="header-profile-picture">
                            {% else %}
                            <i class="fas fa-user default-profile-icon-header"></i>
                            {% endif %}
                        </div>
                    </button>

                    <div id="profile-dropdown" class="absolute right-0 mt-2 w-64 rounded-lg shadow-xl bg-white ring-1 ring-gray-900/10 z-10 hidden">
                        <div class="p-4">
                            <div class="flex items-center mb-3">
                                 {% if user.profile_pic %}
                                    <img src="{{ user.profile_pic.url }}" alt="Profile Picture" class="h-10 w-10 rounded-full mr-3">
                                {% else %}
                                     <i class="fas fa-user h-10 w-10 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-xl mr-3"></i>
                                {% endif %}
                                <div>
                                    <p class="text-sm font-semibold text-gray-900">{{ user.full_name|default:user.username }}</p>
                                     {% if subscription_type == 'FR' %}
                                        <p class="text-xs text-gray-500">Free Plan</p>
                                     {% elif subscription_type == 'PR' %}
                                        <p class="text-xs text-green-600">Premium Plan</p>
                                    {% else %}
                                       <p class="text-xs text-gray-500">No Plan</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% if subscription_type == 'FR' %}
                            <a href="/subscribe" class="block w-full py-2 px-4 text-center bg-gradient-to-r from-yellow-400 to-amber-500 text-white font-bold rounded-full hover:from-yellow-500 hover:to-amber-600 focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:ring-opacity-50 transition-colors duration-200 my-2">
                                <i class="fas fa-star mr-2"></i> Upgrade to Premium
                            </a>
                            {% endif %}

                        </div>
                        <div class="border-t border-gray-200"></div>
                        <div class="py-2">
                            <a href="/myprofile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"><i class="fas fa-user mr-2"></i> My Profile</a>
                            {% if subscription_type == 'PR' %}
                            <a href="/managesubscription" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"><i class="fas fa-cog mr-2"></i> Manage Subscription</a>
                            {% endif %}
                            <a href="/buycoins" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"><i class="fas fa-coins mr-2"></i> Buy Coins</a>
                            <a href="/mywallet" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"><i class="fas fa-wallet mr-2"></i> My Wallet</a>

                        </div>
                        <div class="border-t border-gray-200"></div>
                         <div class="py-2">
                            <a href="/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"><i class="fas fa-sign-out-alt mr-2"></i> Logout</a>
                        </div>
                    </div>

                </div>


                {% else %}
                <a href="/login" class="btn-secondary">Login</a>
                <a href="/signup" class="btn-secondary">Signup</a>
                {% endif %}
            </div>
        </div>
    </header>
    {% endblock %}

    {% block slider-menu %}
    <div id="slide-menu" class="slide-menu">
        <div class="slider-header">
            <a href="/Home" class="audiotype-logo">
                <span class="text-2xl font-extrabold tracking-tighter">AUDIO</span>
                <span class="text-2xl font-extrabold text-red-600 tracking-tighter">X</span>
                <div class="logo-dot"></div>
            </a>
            <span id="close-menu" class="close-btn">&times;</span>
        </div>

        <div class="menu-content">
            {% if user.is_authenticated %}
            <div class="user-info">
                <div class="profile-picture-wrapper">
                    {% if user.profile_pic %}
                    <img src="{{ user.profile_pic.url }}" alt="Profile Picture">
                    {% else %}
                    <i class="fas fa-user default-profile-icon"></i>
                    {% endif %}
                </div>
                <div class="user-names">{{ user.full_name|default:user.username }}</div>
                <div class="user-bio">{{ user.bio|default:"No Bio Yet" }}</div>
                {% if user.is_authenticated %}
                <div
                    class="subscription-status-box {% if subscription_type == 'FR' %}free{% elif subscription_type == 'PR' %}premium{% endif %}">
                    {% if subscription_type == 'FR' %}
                    Free User
                    {% elif subscription_type == 'PR' %}
                    Premium User
                    {% else %}
                    Unknown Subscription
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="login-signup-section">
                <a href="/login" class="login-signup-btn">
                    <i class="fas fa-sign-in-alt mr-2"></i> Login / Signup
                </a>
                <small>Get a personalized experience</small>
            </div>
            {% endif %}

            <ul>
                <li class="feature-item">
                    <a href="/Home" class="menu-item">
                        <i class="fas fa-file-pdf"></i> Generate Audio from PDF
                    </a>
                </li>
                <li class="feature-item">
                    <a href="/Home" class="menu-item">
                        <i class="fas fa-users"></i> Creator Portal
                    </a>
                </li>

                <li class="separator"></li>

                <li>
                    <a href="#" class="menu-item has-submenu">
                        <i class="fas fa-info-circle"></i> About
                    </a>
                    <ul class="sub-menu">
                        <li><a href="/ourteam" class="menu-item"><i class="fas fa-users me-2"></i> Our Team</a></li>
                        <li><a href="/aboutus" class="menu-item"><i class="fas fa-building me-2"></i> About Us</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#" class="menu-item has-submenu">
                        <i class="fas fa-gavel"></i> Legal
                    </a>
                    <ul class="sub-menu">
                        <li><a href="/privacypolicy" class="menu-item"><i class="fas fa-user-secret me-2"></i> Privacy
                                Policy</a></li>
                        <li><a href="/paymentpolicy" class="menu-item"><i class="fas fa-money-check-alt me-2"></i>
                                Payment Policy</a></li>
                        <li><a href="/piracypolicy" class="menu-item"><i class="fas fa-ban me-2"></i> Piracy Policy</a>
                        </li>
                        <li><a href="/termsandconditions" class="menu-item"><i
                                    class="fas fa-file-contract me-2"></i> Terms and Conditions</a></li>
                    </ul>
                </li>
                <li>
                    <a href="/contactus" class="menu-item">
                        <i class="fas fa-envelope"></i> Contact AudioX Support
                    </a>
                </li>
            </ul>
        </div>
        {% if user.is_authenticated %}
        <a href="/logout" class="logout-btn">Logout</a>
        {% endif %}

        <footer>
            <p>Made with <span class="text-red-500">❤️</span> in Pakistan</p>
        </footer>
    </div>
    {% endblock %}

    <main style="flex-grow: 1;">
        {% block content %}
        {% endblock %}
    </main>

    {% block footer %}
    <footer class="bg-[#091e65] text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-between">
                <div class="w-full lg:w-1/3 mb-6 lg:mb-0">
                    <a href="/Home" class="flex items-center audiotype-logo mb-4">
                        <span class="text-3xl font-extrabold tracking-tighter">AUDIO</span>
                        <span class="text-3xl font-extrabold text-red-600 tracking-tighter">X</span>
                        <div class="w-4 h-4 bg-yellow-400 rounded-full ml-1 logo-dot"></div>
                    </a>
                    <p class="mb-4">AudioX is a unique audiobook platform that provides audiobooks in multiple
                        languages. Our mission is to make reading easier and more accessible for people across Pakistan
                        and beyond, by offering content in various regional languages.</p>
                    <hr class="border-t border-gray-400 my-4">
                    <h3 class="font-bold">FOLLOW US ON</h3>
                    <div class="mt-2 space-x-4">
                        <a href="https://facebook.com" class="hover:text-gray-300" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://instagram.com" class="hover:text-gray-300" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
                <div class="w-full lg:w-2/3 flex flex-wrap justify-between">
                    <div class="w-1/2 md:w-1/4 mb-6 md:mb-0">
                        <h3 class="font-bold mb-2">COMPANY</h3>
                        <ul>
                            <li class="mb-2"><a href="/aboutus" class="hover:text-gray-300">About Us</a></li>
                            <li><a href="/ourteam" class="hover:text-gray-300">Our Team</a></li>
                        </ul>
                    </div>
                    <div class="w-1/2 md:w-1/4 mb-6 md:mb-0">
                        <h3 class="font-bold mb-2">GENERAL</h3>
                        <ul>
                            <li class="mb-2"><a href="/Home" class="hover:text-gray-300">Creator Portal</a></li>
                            <li><a href="/contactus" class="hover:text-gray-300">Contact Us</a></li>
                        </ul>
                    </div>
                    <div class="w-1/2 md:w-1/4 mb-6 md:mb-0">
                        <h3 class="font-bold mb-2">LEGAL</h3>
                        <ul>
                            <li class="mb-2"><a href="/paymentpolicy" class="hover:text-gray-300">Payment Policy</a>
                            </li>
                            <li class="mb-2"><a href="/piracypolicy" class="hover:text-gray-300">Piracy Policy</a>
                            </li>
                            <li class="mb-2"><a href="/termsandconditions" class="hover:text-gray-300">Terms &
                                    Conditions</a></li>
                            <li><a href="/privacypolicy" class="hover:text-gray-300">Privacy Policy</a></li>
                        </ul>
                    </div>
                    <div class="w-1/2 md:w-1/4 mb-6 md:mb-0">
                        <h3 class="font-bold mb-2">GENRES</h3>
                        <ul>
                            <li class="mb-2"><a href="#" class="hover:text-gray-300">Historical</a></li>
                            <li class="mb-2"><a href="#" class="hover:text-gray-300">Love</a></li>
                            <li><a href="#" class="hover:text-gray-300">Information</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="text-center mt-8">
                <p>© 2025 AudioX. All Rights Reserved.</p>
            </div>
        </div>
    </footer>
    {% endblock %}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const menuToggle = document.getElementById('menu-toggle');
            const slideMenu = document.getElementById('slide-menu');
            const closeMenu = document.getElementById('close-menu');
            const voiceSearchBtn = document.getElementById('voice-search-btn');
            const searchInput = document.getElementById('search-input');
            const profileDropdownToggle = document.getElementById('profile-dropdown-toggle');
            const profileDropdown = document.getElementById('profile-dropdown');

            if (menuToggle) {
                menuToggle.addEventListener('click', function () {
                    slideMenu.classList.toggle('open');
                });
            }

            if (closeMenu) {
                closeMenu.addEventListener('click', function () {
                    slideMenu.classList.remove('open');
                });
            }

            // Close menu when clicking outside
            if (slideMenu && menuToggle) {
                document.addEventListener('click', function (event) {
                    if (!slideMenu.contains(event.target) && !menuToggle.contains(event.target) && slideMenu.classList.contains('open')) {
                        slideMenu.classList.remove('open');
                    }
                });
            }


            if (voiceSearchBtn) {
                voiceSearchBtn.addEventListener('click', function () {
                    // Check for browser support
                    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                        alert('Speech recognition is not supported in this browser.  Please use Chrome, Edge, or Safari.');
                        return;
                    }

                    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    recognition.lang = 'en-US';
                    recognition.interimResults = false;
                    recognition.maxAlternatives = 1;

                    recognition.onstart = function () {
                        // Visually indicate that recording has started
                        voiceSearchBtn.classList.add('bg-red-500');
                        voiceSearchBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                    };

                    recognition.onend = function () {
                        // Visually indicate that recording has ended
                        voiceSearchBtn.classList.remove('bg-red-500');
                        voiceSearchBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    };

                    recognition.start();

                    recognition.onresult = function (event) {
                        const speechResult = event.results[0][0].transcript;
                        searchInput.value = speechResult;
                    };


                    recognition.onerror = function (event) {
                        console.error("Speech recognition error:", event.error);
                        if (event.error === 'no-speech') {
                            alert('No speech detected. Please try again.');
                        } else if (event.error === 'audio-capture') {
                            alert('No microphone detected. Please connect a microphone and try again.');
                        } else if (event.error === 'not-allowed') {
                            alert('Microphone access denied. Please allow microphone access in your browser settings.');
                        } else {
                            alert('Speech recognition error: ' + event.error);
                        }
                    };
                });
            }
            if (profileDropdownToggle) {
                profileDropdownToggle.addEventListener('click', function (event) {
                    event.stopPropagation(); // Prevent the click from immediately closing the dropdown
                    profileDropdown.classList.toggle('hidden');
                });
            }
            // Close the dropdown when clicking outside of it
            if (profileDropdown) {
                document.addEventListener('click', function (event) {
                    if (!profileDropdown.contains(event.target) && !profileDropdownToggle.contains(event.target)) {
                        profileDropdown.classList.add('hidden');
                    }
                });
            }

        });
    </script>
    {% block javascript %}{% endblock %}
</body>

</html>